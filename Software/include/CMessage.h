//////////////////////////////////////////////////////////////////////////////
//! @file 	CMessage.h
//! @date	Created on: 01.04.2011
//! @author	Falk Schilling
//////////////////////////////////////////////////////////////////////////////

#ifndef CMESSAGE_H_
#define CMESSAGE_H_

//////////////////////////////////////////////////////////////////////////////

#include "CBaseMessage.h"
#include "CConfiguration.h"
#include <iostream>

//////////////////////////////////////////////////////////////////////////////

namespace RGBLightControl {

  //////////////////////////////////////////////////////////////////////////////

  //////////////////////////////////////////////////////////////////////////
  //! This magic byte has to be sent first to the module to let the module
  //! accept the following sequence of bytes.
  //////////////////////////////////////////////////////////////////////////

  const char MAGIC_BYTE = 0xFA;


  //////////////////////////////////////////////////////////////////////////
  //! This union represents the LEDSelect byte for the protocol.
  //////////////////////////////////////////////////////////////////////////

  typedef union {
    char cByte;

    struct {
      char cLowNibble 	: 4;
      char cHighNibble	: 4;
    } 	sByte;
  } LEDSelectByte_t;


  //////////////////////////////////////////////////////////////////////////
  //! These message objects will be sent through the UART to the
  //! DB8FS RGBLightControl system.
  //////////////////////////////////////////////////////////////////////////

  class CMessage : public CBaseMessage
  {
  public:
    CMessage();
    CMessage(const CMessage &);

    explicit CMessage(const CConfiguration &);
    virtual ~CMessage();

    using CBaseMessage::begin;
    using CBaseMessage::end;

    friend std::ostream &operator<<(std::ostream & oStream, const CMessage & msg);
    CMessage & operator=(const CMessage & rhs);

  private:
    char	GetChecksum() const;

  };


  //////////////////////////////////////////////////////////////////////////////

} // namespace RGBLightControl

//////////////////////////////////////////////////////////////////////////////

#endif /* CMESSAGE_H_ */
